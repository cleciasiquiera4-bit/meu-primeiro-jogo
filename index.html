<!doctype html>
<html lang="pt-br">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Jogo de Clecia</title>
  <style>
    :root{
      --bg1:#0f2c5c; --bg2:#2a5aa6;
      --shadow: 0 10px 30px rgba(0,0,0,.18);
      --text:#0b1530; --muted:#5b6b86;
      --accent:#ffcc00; --danger:#ff3b30; --ok:#34c759;
    }
    *{box-sizing:border-box}
    body{
      margin:0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      min-height:100vh; background: linear-gradient(135deg,var(--bg1),var(--bg2));
      color:#fff; display:flex; justify-content:center; padding:18px 10px 30px;
    }
    .wrap{width:min(520px, 100%); display:flex; flex-direction:column; gap:14px;}
    .title{ text-align:center; font-weight:900; font-size: clamp(28px, 6vw, 44px); margin-top:6px; }
    .subtitle{ text-align:center; margin:0; opacity:.9; font-size:15px; }

    .panel{
      background: rgba(255,255,255,.10);
      border:1px solid rgba(255,255,255,.20);
      border-radius: 18px; padding:12px; box-shadow: var(--shadow);
      backdrop-filter: blur(6px);
    }
    .hud{display:flex; gap:10px; flex-wrap:wrap; justify-content:space-between; align-items:center;}
    .pill{
      background: rgba(255,255,255,.14);
      border:1px solid rgba(255,255,255,.22);
      border-radius: 999px; padding:8px 12px; font-weight:800;
      display:flex; gap:8px; align-items:center; min-width: 120px; justify-content:center;
    }
    .pill span{font-weight:900; color:var(--accent)}

    .gameCard{
      background: rgba(255,255,255,.12);
      border:1px solid rgba(255,255,255,.22);
      border-radius: 22px; padding: 14px;
      display:flex; flex-direction:column; gap:12px; align-items:center;
    }
    #board{
      width: min(420px, 92vw); height: min(420px, 92vw);
      background: rgba(255,255,255,.92);
      border-radius: 26px; position:relative; overflow:hidden;
      box-shadow: var(--shadow); touch-action:none; user-select:none;
    }

    /* personagem (agora pode ser emoji ou cor) */
    #player{
      width: 26px; height: 26px;
      background:#111; border-radius: 10px;
      position:absolute; left:50%; top:50%; transform:translate(-50%,-50%);
      display:flex; align-items:center; justify-content:center;
      font-size: 18px;
    }

    .coin{
      width: 20px; height: 20px; border-radius: 50%;
      background: radial-gradient(circle at 30% 30%, #fff7b1, #ffcc00 45%, #c98c00 100%);
      position:absolute; box-shadow: 0 6px 14px rgba(0,0,0,.2);
      border: 1px solid rgba(0,0,0,.08);
    }
    .enemy{
      width: 24px; height: 24px; border-radius: 50%;
      background: radial-gradient(circle at 30% 30%, #ffd0cf, #ff3b30 60%, #a60000 100%);
      position:absolute; box-shadow: 0 8px 16px rgba(0,0,0,.18);
      border: 1px solid rgba(0,0,0,.08);
    }
    .wall{
      position:absolute; background: rgba(15, 44, 92, .25);
      border: 1px solid rgba(15, 44, 92, .22);
      border-radius: 14px; box-shadow: inset 0 2px 0 rgba(255,255,255,.35);
    }

    .controls{
      display:grid; grid-template-columns: 70px 70px 70px; grid-template-rows: 70px 70px 70px;
      gap:12px; justify-content:center; align-items:center; user-select:none;
    }
    .btn{
      width:70px; height:70px; border-radius: 18px;
      background: rgba(255,255,255,.90); border:none; box-shadow: var(--shadow);
      font-size: 28px; font-weight: 900; color: var(--text);
      display:flex; justify-content:center; align-items:center; cursor:pointer;
    }
    .btn:active{ transform: translateY(1px) scale(.99); background: rgba(255,255,255,.98); }
    .btn.disabled{ opacity:.5; pointer-events:none; }

    .row{display:flex; gap:10px; flex-wrap:wrap; justify-content:center; align-items:center; margin-top:6px;}
    .action{
      border:none; border-radius: 14px; padding: 12px 14px;
      font-weight:900; cursor:pointer; box-shadow: var(--shadow);
    }
    .primary{ background: var(--accent); color:#111; }
    .danger{ background: var(--danger); color:white; }
    .ghost{ background: rgba(255,255,255,.12); color:white; border:1px solid rgba(255,255,255,.25); }
    .small{ padding: 10px 12px; font-weight:900; }

    .overlay{
      position:fixed; inset:0; background: rgba(0,0,0,.55);
      display:none; justify-content:center; align-items:center; padding: 16px; z-index:20;
    }
    .overlay.show{ display:flex; }
    .modal{
      width:min(520px, 100%); background:white; color: var(--text);
      border-radius: 18px; padding: 16px; box-shadow: var(--shadow);
    }
    .modal h2{ margin: 4px 0 6px; }
    .modal p{ margin: 0 0 10px; color: var(--muted); }
    .badge{
      display:inline-flex; gap:8px; align-items:center;
      background: #f1f5ff; border:1px solid #dbe6ff;
      padding: 10px 12px; border-radius: 14px; font-weight:900; margin: 8px 0;
    }
    .badge b{ color:#0f2c5c; }

    .help{
      background: rgba(255,255,255,.10); border:1px solid rgba(255,255,255,.20);
      border-radius: 16px; padding: 12px;
    }
    summary{ cursor:pointer; font-weight:900; margin-bottom:6px; }
    .help code{ background: rgba(0,0,0,.18); padding:2px 6px; border-radius: 8px; }

    /* barra de vidas */
    .hearts{ letter-spacing: 2px; }
  </style>
</head>

<body>
  <div class="wrap">
    <div class="title">üéÆ Jogo da Clecia </div>
    <p class="subtitle">Fases + Vidas + Personagem + Som (e depois APK!)</p>

    <div class="panel hud">
      <div class="pill">üë§ <span id="hudName">Jogador</span></div>
      <div class="pill">üß° Vidas: <span id="hudLivesText">‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è</span></div>
      <div class="pill">üß© Fase: <span id="hudLevel">1</span></div>
      <div class="pill">‚≠ê Pontos: <span id="hudScore">0</span></div>
      <div class="pill">üèÜ Recorde: <span id="hudBest">0</span></div>
      <div class="pill">‚è±Ô∏è Tempo: <span id="hudTime">30</span>s</div>
    </div>

    <div class="gameCard">
      <div id="board">
        <div id="player">üôÇ</div>
      </div>

      <div class="controls">
        <div></div>
        <button class="btn" id="upBtn">‚¨ÜÔ∏è</button>
        <div></div>

        <button class="btn" id="leftBtn">‚¨ÖÔ∏è</button>
        <div></div>
        <button class="btn" id="rightBtn">‚û°Ô∏è</button>

        <div></div>
        <button class="btn" id="downBtn">‚¨áÔ∏è</button>
        <div></div>
      </div>

      <div class="row">
        <button class="action primary" id="restartBtn">üîÅ Reiniciar</button>
        <button class="action ghost" id="pauseBtn">‚è∏Ô∏è Pausar</button>
        <button class="action danger" id="muteBtn">üîä Som</button>
      </div>
    </div>

    <div class="help">
      <details>
        <summary>üìå O que cada parte faz (bem simples)</summary>
        <div>
          ‚Ä¢ <b>HTML</b> = as ‚Äúpe√ßas‚Äù (tabuleiro, bot√µes, telas).<br/>
          ‚Ä¢ <b>CSS</b> = beleza (cores, cantos, sombras).<br/>
          ‚Ä¢ <b>JavaScript</b> = regras do jogo (mover, pontos, vidas, fases).<br/>
        </div>
      </details>
    </div>
  </div>

  <!-- Tela Inicial -->
  <div class="overlay show" id="startOverlay">
    <div class="modal">
      <h2>Come√ßar</h2>
      <p>Escolha o nome, o personagem e a dificuldade.</p>

      <div class="row" style="gap:12px; flex-direction:column; align-items:stretch;">
        <div>
          <div style="font-weight:900;color:#0f2c5c;margin-bottom:6px;">Seu nome</div>
          <input id="nameInput" maxlength="18" placeholder="Ex: Clecia" style="width:100%;padding:12px;border-radius:12px;border:1px solid #d8dbe6;font-weight:800;font-size:16px;">
        </div>

        <div>
          <div style="font-weight:900;color:#0f2c5c;margin-bottom:6px;">Personagem</div>
          <select id="skinSelect" style="width:100%;padding:12px;border-radius:12px;border:1px solid #d8dbe6;font-weight:800;font-size:16px;">
            <option value="üôÇ">üôÇ Smile</option>
            <option value="üòé">üòé Cool</option>
            <option value="üëæ">üëæ Alien</option>
            <option value="üê±">üê± Gatinho</option>
            <option value="ü¶Ñ">ü¶Ñ Unic√≥rnio</option>
            <option value="‚ö´">‚ö´ Bola preta</option>
            <option value="üü•">üü• Quadrado vermelho</option>
          </select>
        </div>

        <div>
          <div style="font-weight:900;color:#0f2c5c;margin-bottom:6px;">Dificuldade</div>
          <select id="difficulty" style="width:100%;padding:12px;border-radius:12px;border:1px solid #d8dbe6;font-weight:800;font-size:16px;">
            <option value="easy">F√°cil</option>
            <option value="normal" selected>Normal</option>
            <option value="hard">Dif√≠cil</option>
          </select>
        </div>

        <div class="badge">üéØ Objetivo por fase: <b><span id="goalPreview">8</span> moedas</b></div>

        <button class="action primary" id="startBtn">‚ñ∂Ô∏è Jogar</button>
      </div>
    </div>
  </div>

  <!-- Game Over -->
  <div class="overlay" id="overOverlay">
    <div class="modal">
      <h2>üí• Game Over</h2>
      <p id="overMsg">Voc√™ perdeu!</p>
      <div class="badge">‚≠ê Pontos: <b id="finalScore">0</b></div>
      <div class="badge">üèÜ Recorde: <b id="finalBest">0</b></div>
      <div class="row">
        <button class="action primary" id="playAgainBtn">üîÅ Jogar de novo</button>
        <button class="action ghost" id="backStartBtn">üè† Voltar</button>
      </div>
    </div>
  </div>

  <!-- Vit√≥ria -->
  <div class="overlay" id="winOverlay">
    <div class="modal">
      <h2>üéâ Voc√™ venceu a fase!</h2>
      <p id="winMsg">Boa!</p>
      <div class="badge">üß© Fase: <b id="winLevel">1</b></div>
      <div class="badge">‚≠ê Pontos: <b id="winScore">0</b></div>
      <div class="badge">üèÜ Recorde: <b id="winBest">0</b></div>
      <div class="row">
        <button class="action primary" id="nextLevelBtn">‚û°Ô∏è Pr√≥xima fase</button>
        <button class="action ghost" id="winBackBtn">üè† Voltar</button>
      </div>
    </div>
  </div>

<script>
/* ==== CONFIG ==== */
const BASE = { time: 30, goalCoins: 8, lives: 3 };
let soundOn = true;

/* ==== ELEMENTOS ==== */
const board = document.getElementById("board");
const playerEl = document.getElementById("player");

const hudName = document.getElementById("hudName");
const hudLivesText = document.getElementById("hudLivesText");
const hudLevel = document.getElementById("hudLevel");
const hudScore = document.getElementById("hudScore");
const hudBest = document.getElementById("hudBest");
const hudTime = document.getElementById("hudTime");

const startOverlay = document.getElementById("startOverlay");
const overOverlay = document.getElementById("overOverlay");
const winOverlay = document.getElementById("winOverlay");

const nameInput = document.getElementById("nameInput");
const skinSelect = document.getElementById("skinSelect");
const difficultySel = document.getElementById("difficulty");
const goalPreview = document.getElementById("goalPreview");

const startBtn = document.getElementById("startBtn");
const restartBtn = document.getElementById("restartBtn");
const pauseBtn = document.getElementById("pauseBtn");
const muteBtn = document.getElementById("muteBtn");

const upBtn = document.getElementById("upBtn");
const downBtn = document.getElementById("downBtn");
const leftBtn = document.getElementById("leftBtn");
const rightBtn = document.getElementById("rightBtn");

const overMsg = document.getElementById("overMsg");
const finalScore = document.getElementById("finalScore");
const finalBest = document.getElementById("finalBest");
const playAgainBtn = document.getElementById("playAgainBtn");
const backStartBtn = document.getElementById("backStartBtn");

const winMsg = document.getElementById("winMsg");
const winLevel = document.getElementById("winLevel");
const winScore = document.getElementById("winScore");
const winBest = document.getElementById("winBest");
const nextLevelBtn = document.getElementById("nextLevelBtn");
const winBackBtn = document.getElementById("winBackBtn");

/* ==== √ÅUDIO (sem arquivos) ==== */
let audioCtx=null;
function beep(freq=440, duration=0.08, type="sine", gain=0.08){
  if(!soundOn) return;
  try{
    if(!audioCtx) audioCtx = new (window.AudioContext||window.webkitAudioContext)();
    const o = audioCtx.createOscillator();
    const g = audioCtx.createGain();
    o.type = type; o.frequency.value = freq; g.gain.value = gain;
    o.connect(g); g.connect(audioCtx.destination);
    o.start(); setTimeout(()=>o.stop(), duration*1000);
  }catch(e){}
}
const sfx = {
  coin(){ beep(740,0.06,"triangle",0.09); setTimeout(()=>beep(980,0.06,"triangle",0.07), 60); },
  hit(){ beep(180,0.12,"sawtooth",0.10); },
  win(){ beep(660,0.09,"sine",0.08); setTimeout(()=>beep(880,0.09,"sine",0.08), 90); setTimeout(()=>beep(990,0.11,"sine",0.08), 180); },
};

/* ==== ESTADO ==== */
let player = { x:0, y:0, size:26, speed:10 };
let enemy = { x:0, y:0, size:24, vx:2.0, vy:1.6 };

let score=0;
let best=Number(localStorage.getItem("bestScore2")||"0");
let timeLeft=BASE.time;
let level=1;
let lives=BASE.lives;
let coinsCollected=0;
let goalCoins=BASE.goalCoins;

let paused=false;
let running=false;

let coinEl=null;
let enemyEl=null;
let walls=[];
let timerId=null;
let tickId=null;

/* ==== DIFICULDADE + FASES ==== */
function applyDifficulty(diff){
  if(diff==="easy"){ player.speed=12; enemy.vx=1.6; enemy.vy=1.2; timeLeft=35; }
  else if(diff==="hard"){ player.speed=9; enemy.vx=2.8; enemy.vy=2.3; timeLeft=25; }
  else { player.speed=10; enemy.vx=2.2; enemy.vy=1.8; timeLeft=30; }
}
function applyLevel(){
  // aumenta dificuldade conforme fase
  goalCoins = BASE.goalCoins + (level-1)*3;     // 8, 11, 14...
  timeLeft = Math.max(16, timeLeft - (level-1)*2);
  enemy.vx *= 1 + (level-1)*0.08;
  enemy.vy *= 1 + (level-1)*0.08;
  goalPreview.textContent = goalCoins;
}

/* ==== UTIL ==== */
function clamp(v,min,max){ return Math.max(min,Math.min(max,v)); }
function rectsOverlap(a,b){
  return (a.x < b.x+b.w && a.x+a.w > b.x && a.y < b.y+b.h && a.y+a.h > b.y);
}
function setPos(el,x,y){ el.style.left=x+"px"; el.style.top=y+"px"; }
function boardRect(){ const r=board.getBoundingClientRect(); return {w:r.width,h:r.height}; }

/* ==== OBJETOS ==== */
function clearDynamic(){
  if(coinEl){ coinEl.remove(); coinEl=null; }
  if(enemyEl){ enemyEl.remove(); enemyEl=null; }
  walls.forEach(w=>w.el.remove()); walls=[];
}
function collidesWithWalls(r){
  return walls.some(w => rectsOverlap(r,{x:w.x,y:w.y,w:w.w,h:w.h}));
}
function buildWalls(){
  const {w,h}=boardRect();
  const list = [
    { x:w*0.15, y:h*0.18, w:w*0.22, h:h*0.08 },
    { x:w*0.56, y:h*0.34, w:w*0.24, h:h*0.08 },
    { x:w*0.32, y:h*0.62, w:w*0.18, h:h*0.10 },
  ];
  // em fases mais altas, adiciona mais parede
  if(level>=3) list.push({ x:w*0.62, y:h*0.70, w:w*0.18, h:h*0.08 });
  if(level>=5) list.push({ x:w*0.40, y:h*0.42, w:w*0.16, h:h*0.08 });

  list.forEach(item=>{
    const el=document.createElement("div");
    el.className="wall";
    el.style.left=item.x+"px";
    el.style.top=item.y+"px";
    el.style.width=item.w+"px";
    el.style.height=item.h+"px";
    board.appendChild(el);
    walls.push({...item,el});
  });
}
function spawnCoin(){
  if(coinEl) coinEl.remove();
  coinEl=document.createElement("div");
  coinEl.className="coin";
  board.appendChild(coinEl);

  const {w,h}=boardRect();
  const pad=20;
  let x,y,tries=0;
  do{
    x=Math.random()*(w-pad*2)+pad;
    y=Math.random()*(h-pad*2)+pad;
    tries++;
  }while(collidesWithWalls({x,y,w:20,h:20}) && tries<60);

  setPos(coinEl,x,y);
}
function spawnEnemy(){
  if(enemyEl) enemyEl.remove();
  enemyEl=document.createElement("div");
  enemyEl.className="enemy";
  board.appendChild(enemyEl);

  const {w,h}=boardRect();
  enemy.x=Math.random()*(w-50)+25;
  enemy.y=Math.random()*(h-50)+25;
  // evita nascer em cima
  if(Math.hypot(enemy.x-player.x, enemy.y-player.y) < 90){ enemy.x=20; enemy.y=20; }
  setPos(enemyEl, enemy.x, enemy.y);
}

/* ==== HUD ==== */
function heartsText(n){
  if(n<=0) return "‚Äî";
  return "‚ù§Ô∏è".repeat(n);
}
function updateHud(){
  hudScore.textContent=score;
  hudBest.textContent=best;
  hudTime.textContent=timeLeft;
  hudLevel.textContent=level;
  hudLivesText.textContent = heartsText(lives);
}

/* ==== MOVIMENTO ==== */
function setPlayerPos(){
  setPos(playerEl, player.x-player.size/2, player.y-player.size/2);
}
function movePlayer(dx,dy){
  if(!running || paused) return;

  const {w,h}=boardRect();
  let nx=player.x+dx, ny=player.y+dy;

  nx=clamp(nx, player.size/2, w-player.size/2);
  ny=clamp(ny, player.size/2, h-player.size/2);

  const half=player.size/2;
  const nextRect={x:nx-half,y:ny-half,w:player.size,h:player.size};

  if(collidesWithWalls(nextRect)){
    // tenta eixo separado
    const rectX={x:nx-half,y:player.y-half,w:player.size,h:player.size};
    if(!collidesWithWalls(rectX)) player.x=nx;

    const rectY={x:player.x-half,y:ny-half,w:player.size,h:player.size};
    if(!collidesWithWalls(rectY)) player.y=ny;
  }else{
    player.x=nx; player.y=ny;
  }

  setPlayerPos();
  checkCoin();
  checkEnemyHit();
}

function moveEnemy(){
  if(!running || paused) return;

  const {w,h}=boardRect();
  let nx=enemy.x+enemy.vx;
  let ny=enemy.y+enemy.vy;

  if(nx<0 || nx>w-enemy.size){ enemy.vx*=-1; nx=enemy.x+enemy.vx; }
  if(ny<0 || ny>h-enemy.size){ enemy.vy*=-1; ny=enemy.y+enemy.vy; }

  const nextRect={x:nx,y:ny,w:enemy.size,h:enemy.size};
  if(collidesWithWalls(nextRect)){
    enemy.vx*=-1; enemy.vy*=-1;
    nx=enemy.x+enemy.vx; ny=enemy.y+enemy.vy;
  }

  enemy.x=nx; enemy.y=ny;
  setPos(enemyEl, enemy.x, enemy.y);

  checkEnemyHit();
}

/* ==== COLIS√ïES ==== */
function checkCoin(){
  if(!coinEl) return;
  const c=coinEl.getBoundingClientRect();
  const b=board.getBoundingClientRect();
  const coin={x:c.left-b.left,y:c.top-b.top,w:c.width,h:c.height};
  const half=player.size/2;
  const p={x:player.x-half,y:player.y-half,w:player.size,h:player.size};

  if(rectsOverlap(p,coin)){
    sfx.coin();
    score += 10;
    coinsCollected += 1;
    updateHud();
    spawnCoin();

    if(coinsCollected >= goalCoins){
      winPhase();
    }
  }
}
function loseLife(reason){
  lives -= 1;
  updateHud();
  sfx.hit();

  if(lives <= 0){
    gameOver(reason);
    return;
  }

  // ‚Äúrespawn‚Äù (volta para o meio)
  const {w,h}=boardRect();
  player.x=w/2; player.y=h/2;
  setPlayerPos();
}
function checkEnemyHit(){
  if(!enemyEl) return;
  const half=player.size/2;
  const p={x:player.x-half,y:player.y-half,w:player.size,h:player.size};
  const e={x:enemy.x,y:enemy.y,w:enemy.size,h:enemy.size};
  if(rectsOverlap(p,e)){
    loseLife("Voc√™ encostou no inimigo üò¨");
  }
}

/* ==== TIMER / FIM ==== */
function stopLoops(){
  if(timerId) clearInterval(timerId);
  if(tickId) clearInterval(tickId);
  timerId=null; tickId=null;
}
function tickTime(){
  if(!running || paused) return;
  timeLeft -= 1;
  hudTime.textContent=timeLeft;
  if(timeLeft <= 0){
    loseLife("O tempo acabou ‚è±Ô∏è");
    // reseta tempo da fase (se ainda tem vida)
    if(lives > 0){
      applyDifficulty(difficultySel.value);
      applyLevel();
      updateHud();
    }
  }
}
function startLoops(){
  stopLoops();
  timerId=setInterval(tickTime, 1000);
  tickId=setInterval(moveEnemy, 25);
}

/* ==== TELAS ==== */
function setControlsDisabled(disabled){
  [upBtn,downBtn,leftBtn,rightBtn,restartBtn,pauseBtn,muteBtn].forEach(btn=>{
    btn.classList.toggle("disabled", disabled);
  });
}
function show(el){ el.classList.add("show"); }
function hide(el){ el.classList.remove("show"); }

/* ==== FLUXO: iniciar / reiniciar / vit√≥ria / gameover ==== */
function resetPhase(){
  clearDynamic();
  paused=false;
  pauseBtn.textContent="‚è∏Ô∏è Pausar";

  coinsCollected=0;

  // posi√ß√£o player
  const {w,h}=boardRect();
  player.x=w/2; player.y=h/2;
  setPlayerPos();

  buildWalls();
  spawnCoin();
  spawnEnemy();
}

function startGame(){
  hide(overOverlay);
  hide(winOverlay);
  hide(startOverlay);

  const name = (nameInput.value||"").trim() || "Jogador";
  hudName.textContent=name;

  // personagem
  const skin = skinSelect.value;
  if(skin === "‚ö´"){ playerEl.textContent=""; playerEl.style.background="#111"; playerEl.style.borderRadius="50%"; }
  else if(skin === "üü•"){ playerEl.textContent=""; playerEl.style.background="#ff3b30"; playerEl.style.borderRadius="10px"; }
  else { playerEl.textContent=skin; playerEl.style.background="#111"; playerEl.style.borderRadius="10px"; }

  // reset geral
  score=0;
  lives=BASE.lives;
  level=1;

  applyDifficulty(difficultySel.value);
  applyLevel();
  resetPhase();

  running=true;
  setControlsDisabled(false);
  updateHud();
  startLoops();
}

function restartNow(){
  hide(overOverlay);
  hide(winOverlay);

  applyDifficulty(difficultySel.value);
  applyLevel();
  score=0;
  lives=BASE.lives;
  level=1;

  resetPhase();
  running=true;
  setControlsDisabled(false);
  updateHud();
  startLoops();
}

function winPhase(){
  stopLoops();
  running=false;
  sfx.win();

  if(score > best){
    best=score;
    localStorage.setItem("bestScore2", String(best));
  }
  updateHud();

  winMsg.textContent = `Voc√™ pegou ${goalCoins} moedas!`;
  winLevel.textContent = level;
  winScore.textContent = score;
  winBest.textContent = best;
  show(winOverlay);
  setControlsDisabled(true);
}

function nextLevel(){
  hide(winOverlay);

  level += 1;

  // fica mais dif√≠cil e d√° um ‚Äúb√¥nus‚Äù pequeno por fase
  score += 25;
  applyDifficulty(difficultySel.value);
  applyLevel();

  resetPhase();
  running=true;
  setControlsDisabled(false);
  updateHud();
  startLoops();
}

function gameOver(reason){
  stopLoops();
  running=false;

  if(score > best){
    best=score;
    localStorage.setItem("bestScore2", String(best));
  }
  updateHud();

  overMsg.textContent = reason;
  finalScore.textContent = score;
  finalBest.textContent = best;
  show(overOverlay);
  setControlsDisabled(true);
}

/* ==== CONTROLES ==== */
function bindHold(btn, dx, dy){
  let hold=null;
  const start=(e)=>{
    e.preventDefault();
    movePlayer(dx,dy);
    hold=setInterval(()=>movePlayer(dx,dy), 70);
  };
  const end=()=>{ if(hold) clearInterval(hold); hold=null; };

  btn.addEventListener("touchstart", start, {passive:false});
  btn.addEventListener("touchend", end);
  btn.addEventListener("touchcancel", end);

  btn.addEventListener("mousedown", start);
  btn.addEventListener("mouseup", end);
  btn.addEventListener("mouseleave", end);
}
bindHold(upBtn, 0, -player.speed);
bindHold(downBtn, 0, player.speed);
bindHold(leftBtn, -player.speed, 0);
bindHold(rightBtn, player.speed, 0);

window.addEventListener("keydown", (e)=>{
  const k=e.key.toLowerCase();
  if(e.key==="ArrowUp"||k==="w") movePlayer(0, -player.speed);
  if(e.key==="ArrowDown"||k==="s") movePlayer(0, player.speed);
  if(e.key==="ArrowLeft"||k==="a") movePlayer(-player.speed, 0);
  if(e.key==="ArrowRight"||k==="d") movePlayer(player.speed, 0);
});

/* ==== BOT√ïES ==== */
startBtn.addEventListener("click", startGame);
restartBtn.addEventListener("click", restartNow);

pauseBtn.addEventListener("click", ()=>{
  if(!running) return;
  paused=!paused;
  pauseBtn.textContent = paused ? "‚ñ∂Ô∏è Continuar" : "‚è∏Ô∏è Pausar";
});

muteBtn.addEventListener("click", ()=>{
  soundOn=!soundOn;
  muteBtn.textContent = soundOn ? "üîä Som" : "üîá Mudo";
  if(soundOn) beep(520,0.06,"sine",0.06);
});

playAgainBtn.addEventListener("click", restartNow);
nextLevelBtn.addEventListener("click", nextLevel);

backStartBtn.addEventListener("click", ()=>{ hide(overOverlay); show(startOverlay); setControlsDisabled(true); });
winBackBtn.addEventListener("click", ()=>{ hide(winOverlay); show(startOverlay); setControlsDisabled(true); });

/* ==== INIT ==== */
hudBest.textContent=best;
goalPreview.textContent=BASE.goalCoins;
setControlsDisabled(true);
show(startOverlay);
updateHud();
</script>
</body>
</html>
